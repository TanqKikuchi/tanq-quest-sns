# Google Drive設定ガイド（個人Drive / 共有Drive）

画像アップロード機能で使用するGoogle Driveの設定方法です。

## 個人Driveと共有Driveの選択

### 個人Driveを使用する場合

**メリット:**
- セットアップが簡単（自動でフォルダ作成）
- すぐに使い始められる

**デメリット:**
- 個人アカウントの容量制限に依存
- アカウント削除・退職時の影響
- 容量管理が個人に依存

**推奨:** プロトタイプ、小規模運用、個人開発

### 共有Drive（Shared Drive）を使用する場合

**メリット:**
- 会社全体で容量を共有
- アカウント削除の影響を受けにくい
- チーム全体で管理可能
- 容量が大きい（Workspaceプランによる）

**デメリット:**
- 手動でフォルダIDを設定する必要がある
- 実行ユーザーに適切な権限が必要

**推奨:** 本格運用、チーム運用、会社全体での運用

## セットアップ手順

### 個人Driveを使用する場合

1. **自動セットアップ（推奨）**
   - 初回実行時に自動的に `SNS投稿画像` フォルダが作成されます
   - 追加の設定は不要です

2. **手動セットアップ**
   - Google Driveでフォルダを作成
   - フォルダIDをスクリプトプロパティに設定（`IMAGE_FOLDER_ID`）

### 共有Driveを使用する場合

#### ステップ1: 共有Driveにフォルダを作成

1. Google Driveで共有Driveを開く
2. 「新規」>「フォルダ」をクリック
3. フォルダ名を入力（例: `SNS投稿画像`）
4. フォルダを作成

#### ステップ2: フォルダIDを取得

1. 作成したフォルダを開く
2. ブラウザのアドレスバーからURLをコピー
   - URL例: `https://drive.google.com/drive/folders/1a2b3c4d5e6f7g8h9i0j`
   - フォルダID: `1a2b3c4d5e6f7g8h9i0j`（`folders/` の後の文字列）

#### ステップ3: 実行ユーザーに権限を付与

1. フォルダを右クリック > 「共有」
2. Apps Scriptの実行ユーザーのメールアドレスを追加
3. 権限を「編集者」以上に設定
4. 「送信」をクリック

#### ステップ4: スクリプトプロパティに設定

1. Apps Scriptエディタを開く
2. 「プロジェクトの設定」（歯車アイコン）を開く
3. 「スクリプト プロパティ」セクションで「スクリプト プロパティを追加」をクリック
4. プロパティを追加：
   - **プロパティ名**: `IMAGE_FOLDER_ID`
   - **プロパティ値**: ステップ2で取得したフォルダID
5. 「保存」をクリック

## フォルダIDの確認方法

### 方法1: URLから取得（最も簡単）

1. Google Driveでフォルダを開く
2. ブラウザのアドレスバーからURLをコピー
3. `folders/` の後の文字列がフォルダID

例:
```
https://drive.google.com/drive/folders/1a2b3c4d5e6f7g8h9i0j
                                    ↑ これがフォルダID
```

### 方法2: フォルダのプロパティから取得

1. フォルダを右クリック > 「リンクを取得」
2. 表示されたURLからフォルダIDを抽出

## 権限設定

### 実行ユーザーの権限

Apps Scriptの実行ユーザーは、画像をアップロードするフォルダに対して以下の権限が必要です：

- **編集者**以上（推奨）
- または「閲覧者」+「コメント可」（ファイル作成権限が必要）

### 画像ファイルの公開設定

アップロードされた画像は自動的に以下の設定になります：

- **共有設定**: リンクを知っている全員が閲覧可能
- **用途**: SNSでの画像表示

より厳格なアクセス制御が必要な場合は、コードを変更してください。

## トラブルシューティング

### エラー: "Folder not found"

- フォルダIDが正しいか確認
- 実行ユーザーがフォルダにアクセスできるか確認
- 共有Driveの場合、実行ユーザーに適切な権限が付与されているか確認

### エラー: "Permission denied"

- 実行ユーザーにフォルダへの編集権限があるか確認
- 共有Driveの場合、組織の共有Drive設定を確認

### 画像がアップロードされない

- Drive APIが有効化されているか確認
- 実行ユーザーのDrive容量に余裕があるか確認
- Apps Scriptの実行ログを確認

## 容量管理

### 個人Drive

- 容量使用状況: [Google Driveのストレージ](https://drive.google.com/settings/storage)
- 容量不足の場合: 不要なファイルを削除、または容量プランをアップグレード

### 共有Drive

- 容量使用状況: 共有Driveの管理者が確認可能
- 容量不足の場合: 組織の管理者に相談

## 移行方法

### 個人Driveから共有Driveに移行

1. 共有Driveに新しいフォルダを作成
2. 既存の画像を新しいフォルダに移動（手動またはスクリプト）
3. スクリプトプロパティの `IMAGE_FOLDER_ID` を新しいフォルダIDに更新
4. 既存の投稿の画像URLは変更不要（ファイルIDは変わらないため）

## ベストプラクティス

1. **フォルダ構造**: 日付やユーザー別にサブフォルダを作成することを検討
2. **定期バックアップ**: 重要な画像は定期的にバックアップ
3. **容量監視**: 定期的に容量使用状況を確認
4. **古いファイルの削除**: 一定期間経過した画像の自動削除を検討

